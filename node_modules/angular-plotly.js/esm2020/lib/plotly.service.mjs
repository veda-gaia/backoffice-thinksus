import { Injectable } from '@angular/core';
import * as i0 from "@angular/core";
export class PlotlyService {
    static setModuleName(moduleName) {
        PlotlyService.moduleName = moduleName;
    }
    static getModuleName() {
        return PlotlyService.moduleName;
    }
    static setPlotly(plotly) {
        if (typeof plotly === 'object' && typeof plotly.react !== 'function') {
            throw new Error('Invalid plotly.js version. Please, use any version above 1.40.0');
        }
        PlotlyService.plotly = plotly;
    }
    static insert(instance) {
        const index = PlotlyService.instances.indexOf(instance);
        if (index === -1) {
            PlotlyService.instances.push(instance);
        }
        return instance;
    }
    static remove(div) {
        const index = PlotlyService.instances.indexOf(div);
        if (index >= 0) {
            PlotlyService.instances.splice(index, 1);
            PlotlyService.plotly.purge(div);
        }
    }
    getInstanceByDivId(id) {
        for (const instance of PlotlyService.instances) {
            if (instance && instance.id === id) {
                return instance;
            }
        }
        return undefined;
    }
    async getPlotly() {
        await this.waitFor(() => this._getPlotly() !== 'waiting');
        return this._getPlotly();
    }
    _getPlotly() {
        if (typeof PlotlyService.plotly === 'undefined') {
            const msg = PlotlyService.moduleName === 'ViaCDN'
                ? `Error loading Peer dependency plotly.js from CDN url`
                : `Peer dependency plotly.js isn't installed`;
            throw new Error(msg);
        }
        return PlotlyService.plotly;
    }
    waitFor(fn) {
        return new Promise((resolve) => {
            const localFn = () => {
                fn() ? resolve() : setTimeout(localFn, 10);
            };
            localFn();
        });
    }
    async newPlot(div, data, layout, config, frames) {
        await this.waitFor(() => this._getPlotly() !== 'waiting');
        if (frames) {
            const obj = { data, layout, config, frames };
            return this._getPlotly().newPlot(div, obj).then(() => PlotlyService.insert(div));
        }
        return this._getPlotly().newPlot(div, data, layout, config).then(() => PlotlyService.insert(div));
    }
    plot(div, data, layout, config, frames) {
        if (frames) {
            const obj = { data, layout, config, frames };
            return this._getPlotly().newPlot(div, obj);
        }
        return this._getPlotly().newPlot(div, data, layout, config);
    }
    update(div, data, layout, config, frames) {
        if (frames) {
            const obj = { data, layout, config, frames };
            return this._getPlotly().react(div, obj);
        }
        return this._getPlotly().react(div, data, layout, config);
    }
    resize(div) {
        return this._getPlotly().Plots.resize(div);
    }
}
PlotlyService.instances = [];
PlotlyService.plotly = undefined;
PlotlyService.moduleName = undefined;
PlotlyService.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "15.2.6", ngImport: i0, type: PlotlyService, deps: [], target: i0.ɵɵFactoryTarget.Injectable });
PlotlyService.ɵprov = i0.ɵɵngDeclareInjectable({ minVersion: "12.0.0", version: "15.2.6", ngImport: i0, type: PlotlyService, providedIn: 'root' });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "15.2.6", ngImport: i0, type: PlotlyService, decorators: [{
            type: Injectable,
            args: [{
                    providedIn: 'root'
                }]
        }] });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGxvdGx5LnNlcnZpY2UuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9wcm9qZWN0cy9wbG90bHkvc3JjL2xpYi9wbG90bHkuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDOztBQVMzQyxNQUFNLE9BQU8sYUFBYTtJQUtmLE1BQU0sQ0FBQyxhQUFhLENBQUMsVUFBc0I7UUFDOUMsYUFBYSxDQUFDLFVBQVUsR0FBRyxVQUFVLENBQUM7SUFDMUMsQ0FBQztJQUVNLE1BQU0sQ0FBQyxhQUFhO1FBQ3ZCLE9BQU8sYUFBYSxDQUFDLFVBQVUsQ0FBQztJQUNwQyxDQUFDO0lBRU0sTUFBTSxDQUFDLFNBQVMsQ0FBQyxNQUFXO1FBQy9CLElBQUksT0FBTyxNQUFNLEtBQUssUUFBUSxJQUFJLE9BQU8sTUFBTSxDQUFDLEtBQUssS0FBSyxVQUFVLEVBQUU7WUFDbEUsTUFBTSxJQUFJLEtBQUssQ0FBQyxpRUFBaUUsQ0FBQyxDQUFDO1NBQ3RGO1FBRUQsYUFBYSxDQUFDLE1BQU0sR0FBRyxNQUFNLENBQUM7SUFDbEMsQ0FBQztJQUVNLE1BQU0sQ0FBQyxNQUFNLENBQUMsUUFBa0M7UUFDbkQsTUFBTSxLQUFLLEdBQUcsYUFBYSxDQUFDLFNBQVMsQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDLENBQUM7UUFDeEQsSUFBSSxLQUFLLEtBQUssQ0FBQyxDQUFDLEVBQUU7WUFDZCxhQUFhLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQztTQUMxQztRQUNELE9BQU8sUUFBUSxDQUFDO0lBQ3BCLENBQUM7SUFFTSxNQUFNLENBQUMsTUFBTSxDQUFDLEdBQTZCO1FBQzlDLE1BQU0sS0FBSyxHQUFHLGFBQWEsQ0FBQyxTQUFTLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQ25ELElBQUksS0FBSyxJQUFJLENBQUMsRUFBRTtZQUNaLGFB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LEVBQUUsSUFBSSxFQUFFLE1BQU0sRUFBRSxNQUFNLENBQWlCLENBQUM7SUFDaEYsQ0FBQztJQUVNLE1BQU0sQ0FBQyxHQUE2QixFQUFFLElBQW1CLEVBQUUsTUFBK0IsRUFBRSxNQUErQixFQUFFLE1BQWlDO1FBQ2pLLElBQUksTUFBTSxFQUFFO1lBQ1IsTUFBTSxHQUFHLEdBQUcsRUFBRSxJQUFJLEVBQUUsTUFBTSxFQUFFLE1BQU0sRUFBRSxNQUFNLEVBQUUsQ0FBQztZQUM3QyxPQUFPLElBQUksQ0FBQyxVQUFVLEVBQUUsQ0FBQyxLQUFLLENBQUMsR0FBRyxFQUFFLEdBQUcsQ0FBaUIsQ0FBQztTQUM1RDtRQUVELE9BQU8sSUFBSSxDQUFDLFVBQVUsRUFBRSxDQUFDLEtBQUssQ0FBQyxHQUFHLEVBQUUsSUFBSSxFQUFFLE1BQU0sRUFBRSxNQUFNLENBQWlCLENBQUM7SUFDOUUsQ0FBQztJQUVNLE1BQU0sQ0FBQyxHQUE2QjtRQUN2QyxPQUFPLElBQUksQ0FBQyxVQUFVLEVBQUUsQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBQy9DLENBQUM7O0FBdkdnQix1QkFBUyxHQUErQixFQUFFLENBQUM7QUFDM0Msb0JBQU0sR0FBUyxTQUFTLENBQUM7QUFDekIsd0JBQVUsR0FBZ0IsU0FBUyxDQUFDOzBHQUg1QyxhQUFhOzhHQUFiLGFBQWEsY0FGVixNQUFNOzJGQUVULGFBQWE7a0JBSHpCLFVBQVU7bUJBQUM7b0JBQ1IsVUFBVSxFQUFFLE1BQU07aUJBQ3JCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0YWJsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgUGxvdGx5IH0gZnJvbSAnLi9wbG90bHkuaW50ZXJmYWNlJztcblxudHlwZSBQbG90bHlOYW1lID0gJ1Bsb3RseScgfCAnVmlhQ0ROJyB8ICdWaWFXaW5kb3cnIHwgdW5kZWZpbmVkO1xuXG5cbkBJbmplY3RhYmxlKHtcbiAgICBwcm92aWRlZEluOiAncm9vdCdcbn0pXG5leHBvcnQgY2xhc3MgUGxvdGx5U2VydmljZSB7XG4gICAgcHJvdGVjdGVkIHN0YXRpYyBpbnN0YW5jZXM6IFBsb3RseS5QbG90bHlIVE1MRWxlbWVudFtdID0gW107XG4gICAgcHJvdGVjdGVkIHN0YXRpYyBwbG90bHk/OiBhbnkgPSB1bmRlZmluZWQ7XG4gICAgcHJvdGVjdGVkIHN0YXRpYyBtb2R1bGVOYW1lPzogUGxvdGx5TmFtZSA9IHVuZGVmaW5lZDtcblxuICAgIHB1YmxpYyBzdGF0aWMgc2V0TW9kdWxlTmFtZShtb2R1bGVOYW1lOiBQbG90bHlOYW1lKTogdm9pZCB7XG4gICAgICAgIFBsb3RseVNlcnZpY2UubW9kdWxlTmFtZSA9IG1vZHVsZU5hbWU7XG4gICAgfVxuXG4gICAgcHVibGljIHN0YXRpYyBnZXRNb2R1bGVOYW1lKCk6IFBsb3RseU5hbWUge1xuICAgICAgICByZXR1cm4gUGxvdGx5U2VydmljZS5tb2R1bGVOYW1lO1xuICAgIH1cblxuICAgIHB1YmxpYyBzdGF0aWMgc2V0UGxvdGx5KHBsb3RseTogYW55KTogdm9pZCB7XG4gICAgICAgIGlmICh0eXBlb2YgcGxvdGx5ID09PSAnb2JqZWN0JyAmJiB0eXBlb2YgcGxvdGx5LnJlYWN0ICE9PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ludmFsaWQgcGxvdGx5LmpzIHZlcnNpb24uIFBsZWFzZSwgdXNlIGFueSB2ZXJzaW9uIGFib3ZlIDEuNDAuMCcpO1xuICAgICAgICB9XG5cbiAgICAgICAgUGxvdGx5U2VydmljZS5wbG90bHkgPSBwbG90bHk7XG4gICAgfVxuXG4gICAgcHVibGljIHN0YXRpYyBpbnNlcnQoaW5zdGFuY2U6IFBsb3RseS5QbG90bHlIVE1MRWxlbWVudCk6IFBsb3RseS5QbG90bHlIVE1MRWxlbWVudCB7XG4gICAgICAgIGNvbnN0IGluZGV4ID0gUGxvdGx5U2VydmljZS5pbnN0YW5jZXMuaW5kZXhPZihpbnN0YW5jZSk7XG4gICAgICAgIGlmIChpbmRleCA9PT0gLTEpIHtcbiAgICAgICAgICAgIFBsb3RseVNlcnZpY2UuaW5zdGFuY2VzLnB1c2goaW5zdGFuY2UpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBpbnN0YW5jZTtcbiAgICB9XG5cbiAgICBwdWJsaWMgc3RhdGljIHJlbW92ZShkaXY6IFBsb3RseS5QbG90bHlIVE1MRWxlbWVudCk6IHZvaWQge1xuICAgICAgICBjb25zdCBpbmRleCA9IFBsb3RseVNlcnZpY2UuaW5zdGFuY2VzLmluZGV4T2YoZGl2KTtcbiAgICAgICAgaWYgKGluZGV4ID49IDApIHtcbiAgICAgICAgICAgIFBsb3RseVNlcnZpY2UuaW5zdGFuY2VzLnNwbGljZShpbmRleCwgMSk7XG4gICAgICAgICAgICBQbG90bHlTZXJ2aWNlLnBsb3RseS5wdXJnZShkaXYpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHVibGljIGdldEluc3RhbmNlQnlEaXZJZChpZDogc3RyaW5nKTogUGxvdGx5LlBsb3RseUhUTUxFbGVtZW50IHwgdW5kZWZpbmVkIHtcbiAgICAgICAgZm9yIChjb25zdCBpbnN0YW5jZSBvZiBQbG90bHlTZXJ2aWNlLmluc3RhbmNlcykge1xuICAgICAgICAgICAgaWYgKGluc3RhbmNlICYmIGluc3RhbmNlLmlkID09PSBpZCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBpbnN0YW5jZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgIH1cblxuICAgIHB1YmxpYyBhc3luYyBnZXRQbG90bHkoKTogUHJvbWlzZTxhbnk+IHtcbiAgICAgICAgYXdhaXQgdGhpcy53YWl0Rm9yKCgpID0+IHRoaXMuX2dldFBsb3RseSgpICE9PSAnd2FpdGluZycpO1xuICAgICAgICByZXR1cm4gdGhpcy5fZ2V0UGxvdGx5KCk7XG4gICAgfVxuXG4gICAgcHJvdGVjdGVkIF9nZXRQbG90bHkoKTogYW55IHtcbiAgICAgICAgaWYgKHR5cGVvZiBQbG90bHlTZXJ2aWNlLnBsb3RseSA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgIGNvbnN0IG1zZyA9IFBsb3RseVNlcnZpY2UubW9kdWxlTmFtZSA9PT0gJ1ZpYUNETidcbiAgICAgICAgICAgICAgICA/IGBFcnJvciBsb2FkaW5nIFBlZXIgZGVwZW5kZW5jeSBwbG90bHkuanMgZnJvbSBDRE4gdXJsYFxuICAgICAgICAgICAgICAgIDogYFBlZXIgZGVwZW5kZW5jeSBwbG90bHkuanMgaXNuJ3QgaW5zdGFsbGVkYDtcblxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKG1zZyk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gUGxvdGx5U2VydmljZS5wbG90bHk7XG4gICAgfVxuXG4gICAgcHJvdGVjdGVkIHdhaXRGb3IoZm46ICgpID0+IGJvb2xlYW4pOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBsb2NhbEZuID0gKCkgPT4ge1xuICAgICAgICAgICAgICAgIGZuKCkgPyByZXNvbHZlKCkgOiBzZXRUaW1lb3V0KGxvY2FsRm4sIDEwKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIGxvY2FsRm4oKTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgcHVibGljIGFzeW5jIG5ld1Bsb3QoZGl2OiBIVE1MRGl2RWxlbWVudCwgZGF0YTogUGxvdGx5LkRhdGFbXSwgbGF5b3V0PzogUGFydGlhbDxQbG90bHkuTGF5b3V0PiwgY29uZmlnPzogUGFydGlhbDxQbG90bHkuQ29uZmlnPiwgZnJhbWVzPzogUGFydGlhbDxQbG90bHkuQ29uZmlnPltdKTogUHJvbWlzZTxhbnk+IHtcbiAgICAgICAgYXdhaXQgdGhpcy53YWl0Rm9yKCgpID0+IHRoaXMuX2dldFBsb3RseSgpICE9PSAnd2FpdGluZycpO1xuXG4gICAgICAgIGlmIChmcmFtZXMpIHtcbiAgICAgICAgICAgIGNvbnN0IG9iaiA9IHsgZGF0YSwgbGF5b3V0LCBjb25maWcsIGZyYW1lcyB9O1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2dldFBsb3RseSgpLm5ld1Bsb3QoZGl2LCBvYmopLnRoZW4oKCkgPT4gUGxvdGx5U2VydmljZS5pbnNlcnQoZGl2IGFzIGFueSkpIGFzIFByb21pc2U8YW55PjtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB0aGlzLl9nZXRQbG90bHkoKS5uZXdQbG90KGRpdiwgZGF0YSwgbGF5b3V0LCBjb25maWcpLnRoZW4oKCkgPT4gUGxvdGx5U2VydmljZS5pbnNlcnQoZGl2IGFzIGFueSkpIGFzIFByb21pc2U8YW55PjtcbiAgICB9XG5cbiAgICBwdWJsaWMgcGxvdChkaXY6IFBsb3RseS5QbG90bHlIVE1MRWxlbWVudCwgZGF0YTogUGxvdGx5LkRhdGFbXSwgbGF5b3V0PzogUGFydGlhbDxQbG90bHkuTGF5b3V0PiwgY29uZmlnPzogUGFydGlhbDxQbG90bHkuQ29uZmlnPiwgZnJhbWVzPzogUGFydGlhbDxQbG90bHkuQ29uZmlnPltdKTogUHJvbWlzZTxhbnk+IHtcbiAgICAgICAgaWYgKGZyYW1lcykge1xuICAgICAgICAgICAgY29uc3Qgb2JqID0geyBkYXRhLCBsYXlvdXQsIGNvbmZpZywgZnJhbWVzIH07XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fZ2V0UGxvdGx5KCkubmV3UGxvdChkaXYsIG9iaikgYXMgUHJvbWlzZTxhbnk+O1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHRoaXMuX2dldFBsb3RseSgpLm5ld1Bsb3QoZGl2LCBkYXRhLCBsYXlvdXQsIGNvbmZpZykgYXMgUHJvbWlzZTxhbnk+O1xuICAgIH1cblxuICAgIHB1YmxpYyB1cGRhdGUoZGl2OiBQbG90bHkuUGxvdGx5SFRNTEVsZW1lbnQsIGRhdGE6IFBsb3RseS5EYXRhW10sIGxheW91dD86IFBhcnRpYWw8UGxvdGx5LkxheW91dD4sIGNvbmZpZz86IFBhcnRpYWw8UGxvdGx5LkNvbmZpZz4sIGZyYW1lcz86IFBhcnRpYWw8UGxvdGx5LkNvbmZpZz5bXSk6IFByb21pc2U8YW55PiB7XG4gICAgICAgIGlmIChmcmFtZXMpIHtcbiAgICAgICAgICAgIGNvbnN0IG9iaiA9IHsgZGF0YSwgbGF5b3V0LCBjb25maWcsIGZyYW1lcyB9O1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2dldFBsb3RseSgpLnJlYWN0KGRpdiwgb2JqKSBhcyBQcm9taXNlPGFueT47XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gdGhpcy5fZ2V0UGxvdGx5KCkucmVhY3QoZGl2LCBkYXRhLCBsYXlvdXQsIGNvbmZpZykgYXMgUHJvbWlzZTxhbnk+O1xuICAgIH1cblxuICAgIHB1YmxpYyByZXNpemUoZGl2OiBQbG90bHkuUGxvdGx5SFRNTEVsZW1lbnQpOiB2b2lkIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2dldFBsb3RseSgpLlBsb3RzLnJlc2l6ZShkaXYpO1xuICAgIH1cbn1cbiJdfQ==